<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <title>Port Mapping Development Servers — Kevin Jalbert</title> <link href="/stylesheets/app.css" rel=stylesheet /> <link rel=alternate type="application/atom+xml" title="Posts — Kevin Jalbert" href="/feed.xml"/> </head> <div class=container> <div class=header> <div class="col-xs-4 col-md-4 banner"> <a href="/">Kevin Jalbert</a> </div> <div class="col-xs-8 col-md-8 navigation"> <ul> <li><input placeholder=Search class="search ui-autocomplete-input ui-corner-all" autocomplete=on></li> <li><a href="/about/">About</a></li> <li><a href="/now/">Now</a></li> </ul> </div> </div> </div> <body> <div class="container content article"> <div class=row> <div class=col-md-12> <h1 class=article__title><p>Port Mapping Development Servers</p> </h1> <div class="row article__meta-info"> <div class="col-xs-4 col-md-4"> <div class=article__date>July 30, 2016 </div> </div> <div class="col-xs-4 col-md-4"> <div class=article__read-time>3 min read</div> </div> <div class="col-xs-4 col-md-4"> <div class=article__comments> <a href="https://kevinjalbert.com/port-mapping-development-servers/#disqus_thread">0 Comments</a> </div> </div> </div> <div class="row article__meta-tags"> <div class="col-xs-12 col-md-12"> <div class=article__tags> <a href="/tags/development/">development</a> <a href="/tags/shell/">shell</a> <a href="/tags/ruby/">ruby</a> </div> </div> </div> <div class=article__separator></div> <p>As a developer its not uncommon to juggle multiple servers that interact with each other during development. Ensuring that each server has the correct port set while working off of <code>localhost</code> is a cumbersome and error prone issue. <a href="https://github.com/kevinjalbert/port_map">port_map</a> is a ruby utility that provides a simple and almost automatic solution to this problem.</p> <p>I developed this utility gem to solve a personal problem of mine while dealing with multiple web servers during development. The next section (<em>Example Scenario</em>) comes directly from <code>port_map</code>&rsquo;s <a href="https://github.com/kevinjalbert/port_map#example-scenario">README</a>.</p> <h2>Example Scenario</h2> <p>You are developing a service that uses multiple web servers. You have two rails applications and one ember application.</p> <table><thead> <tr> <th>Application</th> <th>Directory</th> <th>Command</th> <th>Local URL</th> </tr> </thead><tbody> <tr> <td>Rails API</td> <td><code>/api/</code></td> <td><code>rails server</code></td> <td>http://localhost:3000</td> </tr> <tr> <td>Rails Background Jobs</td> <td><code>/jobs/</code></td> <td><code>rails server --port 3001</code></td> <td>http://localhost:3001</td> </tr> <tr> <td>Ember Application</td> <td><code>/ember/</code></td> <td><code>ember server</code></td> <td>http://localhost:4200</td> </tr> </tbody></table> <h3>The Problem</h3> <p>In each of these applications there is some configuration work required to ensure that they communicate on the correct ports. There are two issues here:</p> <ul> <li>As we add more web servers we have to avoid clashing on existing ports.</li> <li>You have to make sure that you correctly start each server with the right port number.</li> </ul> <h3><code>port_map</code> to the Rescue!</h3> <p>We&rsquo;re going to transform this unwieldy scenario into an organized and easy to manage one using <code>port_map</code>.</p> <table><thead> <tr> <th>Application</th> <th>Directory</th> <th>Command</th> <th>Local URL</th> </tr> </thead><tbody> <tr> <td>Rails API</td> <td><code>/api/</code></td> <td><code>port_map rails server</code></td> <td>http://api.dev</td> </tr> <tr> <td>Rails Background Jobs</td> <td><code>/jobs/</code></td> <td><code>port_map rails server</code></td> <td>http://jobs.dev</td> </tr> <tr> <td>Ember Application</td> <td><code>/ember/</code></td> <td><code>port_map ember server</code></td> <td>http://ember.dev</td> </tr> </tbody></table> <p>The domain names can be configured with environment variables, but by default they are based on the directory&rsquo;s name.</p> <p>You can close and restart each web server multiple times and they will continue to use the same domain names. <code>port_map</code> provides an easy way to logically name each web server, as well as remove the need of specifying ports.</p> <h2>Putting it to the Test</h2> <p>I have been using <code>port_map</code> for a little over 6 months (as of writing this), and it has served me quite well. The beauty of <code>port_map</code> is that it works on any shell command that accepts a <code>--port &lt;number&gt;</code> or <code>-p &lt;number&gt;</code> flag. I enjoy finding new uses for <code>port_map</code> in other web servers like <a href="https://middlemanapp.com">middleman</a> and <a href="https://jekyllrb.com">jekyll</a>.</p> <p>There was one issue that I have hit, although its not a deal breaker <a href="https://github.com/kevinjalbert/port_map/issues/7">kevinjalbert/port_map#7</a>, although I suspect I can fix this eventually.</p> <p>As <code>port_map</code> is a wrapper around the command there are interesting issues that can arise. I use <a href="http://www.zsh.org/">Zsh</a> as my shell along with a bunch of aliases it was necessary for <code>port_map</code> to support running commands that contain aliases. I recently moved to <a href="https://zplug.sh/">zplug</a> as my Zsh plugin framework, where I encountered the following issue <a href="https://github.com/zplug/zplug/issues/209">zplug/zplug#209</a>.</p> <p>One last inconvenience is that <code>port_map</code> is a RubyGem, which is effectively tied to a specific Ruby version. When dealing with multiple Ruby version projects using <a href="https://rvm.io/">rvm</a>/<a href="http://rbenv.org/">rbenv</a> sometimes <code>port_map</code> is not installed. It is a slight detour to install <code>port_map</code> for the current Ruby version when I switch to a new Ruby version. Ideally <code>port_map</code> would not be tied to Ruby, and instead is a transportable executable (for example one written in Bash or Go).</p> <h2>The Future</h2> <p>I will continue to use <code>port_map</code> until I can spend some time to dig deeper into <a href="https://www.vagrantup.com/">Vagrant</a> and <a href="https://www.docker.com/">Docker</a>. These two technologies isolate and containerize environments (web services). I can see the benefits in such technologies as they are not dependant on the host environment, which in my case is my laptop.</p> <div id=disqus_thread></div> <script>
//<![CDATA[
                  var disqus_shortname = 'kevinjalbert';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <a href="http://disqus.com" class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a> <script>
//<![CDATA[
    var disqus_shortname = 'kevinjalbert';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script> </div> </div> </div> </body> <div class="col-md-12 footer__copywrite"> &copy; 2016 Kevin Jalbert </div> </html> <script src="/javascripts/app.js"></script> <script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16620161-5']);
    _gaq.push(['_trackPageview']);

    setTimeout(function() {
      window.onscroll = function() {
        window.onscroll = null; // Only track the event once
        _gaq.push(['_trackEvent', 'scroll', 'read']);
      }
    }, 5000);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>