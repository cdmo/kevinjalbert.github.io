<!DOCTYPE html> <html lang=en> <head> <meta charset=utf-8> <meta http-equiv=X-UA-Compatible content='IE=edge;chrome=1'/> <meta name=viewport content="width=device-width, initial-scale=1"> <script>addEventListener('error', window.__e=function f(e){f.q=f.q||[];f.q.push(e)});</script> <link rel=canonical href=https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/> <title>Bluetooth Connection/Battery Script for macOS | Kevin Jalbert</title> <meta name=description content="Using AppleScript to simplify connecting bluetooth earphones to macOS."/> <meta name=keywords content="hardware, bluetooth, macOS"/> <meta name=datePublished content="2017-04-08 00:00:00 UTC"/> <meta property="og:article:published_time" content="2017-04-08 00:00:00 UTC"/> <meta name=author content="Kevin Jalbert"/> <meta property="og:article:author" content="2017-04-08 00:00:00 UTC"/> <meta name=url content="https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/"/> <meta property="og:url" content="https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/"/> <meta name=site content="Kevin Jalbert"/> <meta property="og:site_name" content="Kevin Jalbert"/> <meta name="twitter:card" content=summary_large_image /> <meta name="twitter:creator" content="@kevinjalbert"/> <meta name="twitter:description" content="Using AppleScript to simplify connecting bluetooth earphones to macOS."/> <meta name="twitter:image:src" content="https://kevinjalbert.com/images/2017-04-09-bluetooth-connection-battery-script-for-macos/beatsx.jpg"/> <meta name="twitter:site" content="Kevin Jalbert"/> <meta name="twitter:title" content="Bluetooth Connection/Battery Script for macOS"/> <meta property="og:description" content="Using AppleScript to simplify connecting bluetooth earphones to macOS."/> <meta property="og:image" content="https://kevinjalbert.com/images/2017-04-09-bluetooth-connection-battery-script-for-macos/beatsx.jpg"/> <meta property="og:title" content="Bluetooth Connection/Battery Script for macOS"/> <script type="application/ld+json">
    {
       "@context": "http://schema.org",
       "@type": "BlogPosting",
       "headline": "Bluetooth Connection/Battery Script for macOS",
       "keywords": "hardware, bluetooth, macOS",
       "url": "https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/",
       "datePublished": "2017-04-08 00:00:00 UTC",
       "dateModified": "2017-04-08 00:00:00 UTC",
       "author": {
         "@type": "Person",
         "name": "Kevin Jalbert",
         "sameAs": [
           "https://twitter.com/kevinjalbert",
           "https://github.com/kevinjalbert",
           "https://keybase.io/kevinjalbert",
           "https://reddit.com/user/kevinjalbert"
         ]
       },
       "mainEntityOfPage": {
          "@type": "WebPage",
         "@id": "https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/"
       }
    }
  </script> <link href="/stylesheets/app.css" rel=stylesheet /> <link rel=alternate type="application/atom+xml" title="Articles | Kevin Jalbert" href="/feed.xml"/> <script async src="/vendor/analytics/index.js"></script> <script async src="https://www.google-analytics.com/analytics.js"></script> </head> <div class=container> <div class=header> <div class="col-xs-12 col-sm-7 navigation"> <a class=banner href="/">Kevin Jalbert</a> <a href="/about/">About</a> <a href="/now/">Now</a> <a href="https://github.com/kevinjalbert/ama/blob/master/README.md">AMA</a> </div> <div class="col-xs-12 col-sm-5 search-component"> <input placeholder=Search class="search ui-autocomplete-input ui-corner-all" autocomplete=on> </div> </div> </div> <body> <div class="container content article"> <div class=row> <div class=col-md-12> <h1 class=article__title><p>Bluetooth Connection/Battery Script for macOS</p> </h1> <div class="row article__meta-info"> <div class="col-xs-4 col-md-4"> <div class="article__date entry-date">April 8, 2017 </div> </div> <div class="col-xs-4 col-md-4"> <div class=article__read-time>1 min read</div> </div> <div class="col-xs-4 col-md-4"> <div class=article__comments> <a href="https://kevinjalbert.com/bluetooth-connection-battery-script-for-macos/#disqus_thread">0 Comments</a> </div> </div> </div> <div class="row article__meta-tags"> <div class="col-xs-12 col-md-12"> <div class=article__tags> <a href="/tags/hardware/">hardware</a> <a href="/tags/bluetooth/">bluetooth</a> <a href="/tags/macos/">macOS</a> </div> </div> </div> <div class=article__separator></div> <div class=newsletter__form> <div class="panel panel-default"> <div class=panel-heading> <h4 class="panel-title accordion-toggle collapsed" data-toggle=collapse data-parent="#accordion" href="#newsletterFormCollapse"> Signup for my Newsletter </h4> </div> <div id=newsletterFormCollapse class="panel-collapse collapse"> <div class=panel-body> <link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel=stylesheet> <style>
              #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
              /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                 We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
        </style> <div id=mc_embed_signup> <form action="//kevinjalbert.us14.list-manage.com/subscribe/post?u=fe02783eec556cfc2893fe174&amp;id=aecd14f8e6" method=post id=mc-embedded-subscribe-form name=mc-embedded-subscribe-form class=validate target=_blank novalidate> <div id=mc_embed_signup_scroll> <input type=email value="" name=EMAIL class=email id=mce-EMAIL placeholder="email address" required> <div style="position: absolute; left: -5000px;" aria-hidden=true><input name=b_fe02783eec556cfc2893fe174_aecd14f8e6 tabindex=-1 value=""></div> <div class=clear><input type=submit value=Subscribe name=subscribe id=mc-embedded-subscribe class=button></div> </div> </form> </div> </div> </div> </div> </div> <p><img width=4032 height=3024 src="/images/2017-04-09-bluetooth-connection-battery-script-for-macos/beatsx.jpg"/> <em>My BeatsX Earphones</em></p> <p>I recently purchased a pair of <a href="http://www.apple.com/ca/shop/product/MLYE2LL/A/beatsx-earphones-black">BeatsX Earphones</a> as I wanted to stop dealing with wired earbuds. For some reason, the wired connections always stopped working properly after a number of months. I supect it is just the stress on the wire while in my pocket during my commute.</p> <p>When arriving at work, or really anytime I am transitioning from iPhone to MacBook Pro, I have to manually connect my BeatsX to the MacBook Pro. I wanted to automate this process, down to a simple command. If the BeatsX are in range and on they would initiate the connection process to my machine. In addition, it would be nice to have a way to monitor the battery level using a similar process.</p> <p>Looking around, I couldn&rsquo;t find any way through a command-line interface to do what I wanted. I eventually figured out that I could use macOS&rsquo;s <a href="https://en.wikipedia.org/wiki/AppleScript">AppleScript</a> to automate the menu navigation.</p> <p>The following script will attempt to connect to the desired device (i.e., BeatsX by name). If it is already connected then it will retrieve the battery level.</p> <pre class="highlight applescript"><code><span class="nb">activate</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"SystemUIServer"</span><span class="w">
</span><span class="k">set</span><span class="w"> </span><span class="nv">deviceName</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="s2">"Kevin Jalbert's BeatsX"</span><span class="w">

</span><span class="k">tell</span><span class="w"> </span><span class="nb">application</span><span class="w"> </span><span class="s2">"System Events"</span><span class="w">
  </span><span class="k">tell</span><span class="w"> </span><span class="nv">process</span><span class="w"> </span><span class="s2">"SystemUIServer"</span><span class="w">
    </span><span class="k">set</span><span class="w"> </span><span class="nv">bluetoothMenu</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nv">bar</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="nb">whose</span><span class="w"> </span><span class="nv">description</span><span class="w"> </span><span class="ow">contains</span><span class="w"> </span><span class="s2">"bluetooth"</span><span class="p">)</span><span class="w">
    </span><span class="k">tell</span><span class="w"> </span><span class="nv">bluetoothMenu</span><span class="w">
      </span><span class="nv">click</span><span class="w">

      </span><span class="k">set</span><span class="w"> </span><span class="nv">deviceMenuItem</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="nv">deviceName</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
      </span><span class="k">tell</span><span class="w"> </span><span class="nv">deviceMenuItem</span><span class="w">
        </span><span class="nv">click</span><span class="w">

        </span><span class="k">if</span><span class="w"> </span><span class="nb">exists</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Connect"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">then</span><span class="w">
          </span><span class="nv">click</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="s2">"Connect"</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="w">
          </span><span class="k">return</span><span class="w"> </span><span class="s2">"Connecting..."</span><span class="w">
        </span><span class="k">else</span><span class="w">
          </span><span class="k">set</span><span class="w"> </span><span class="nv">batteryLevelMenuItem</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">(</span><span class="na">menu</span><span class="w"> </span><span class="nb">item</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="na">menu</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w">
          </span><span class="k">tell</span><span class="w"> </span><span class="nv">batteryLevelMenuItem</span><span class="w">
            </span><span class="k">set</span><span class="w"> </span><span class="nv">batteryLevelText</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="na">title</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nv">batteryLevelMenuItem</span><span class="w">
          </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">

          </span><span class="na">key code</span><span class="w"> </span><span class="mi">53</span><span class="w"> </span><span class="c1">-- esc key</span><span class="w">

          </span><span class="k">return</span><span class="w"> </span><span class="nv">batteryLevelText</span><span class="w">
        </span><span class="k">end</span><span class="w"> </span><span class="k">if</span><span class="w">
      </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
    </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
  </span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span><span class="k">end</span><span class="w"> </span><span class="k">tell</span><span class="w">
</span></code></pre> <p>This on its own is a nice win and works as desired. Now, I&rsquo;m a heavy user of <a href="https://www.alfredapp.com/">Alfred</a> and I quickly threw together a workflow that uses this script. I now get a notification during connection, and repeated invokations will display the battery level.</p> <p><img width=2104 height=632 src="/images/2017-04-09-bluetooth-connection-battery-script-for-macos/alfred-workflow.gif"/> <em>My BeatsX Alfred workflow</em></p> <div class=article__comments-button><button type=button class="btn btn-default show-comments">Click to Disqus</button></div> <div id=disqus_thread></div> </div> </div> </div> <script>
//<![CDATA[
    var disqus_shortname = 'kevinjalbert';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
//]]>
</script> </body> <div class="col-md-12 footer__copywrite"> &copy; 2017 Kevin Jalbert </div> </html> <script src="/javascripts/app.js"></script>